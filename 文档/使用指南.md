# 配置驱动页面生成系统 - 使用指南

## 🚀 快速开始

### 1. 系统概述

配置驱动的页面生成系统已经成功部署到项目中，现在你可以通过简单的配置文件来管理所有页面，而不需要手动修改路由和菜单文件。

### 2. 核心文件

- **配置文件**: `src/config/pages.json` - 所有页面的配置信息
- **动态页面组件**: `src/components/DynamicPage.vue` - 根据配置渲染页面
- **资源渲染器**: `src/components/ResourceRenderer.vue` - 动态渲染不同类型的资源控件
- **页面生成工具**: `src/utils/pageGenerator.js` - 辅助工具函数

## 📝 新增页面流程

### 方法一：手动配置（推荐）

1. **在 `src/config/pages.json` 中添加页面配置**：

```json
{
  "id": "newPage",
  "title": "新页面",
  "path": "/new-page",
  "image": "图片URL或本地路径",
  "category": "study",
  "components": {
    "phone": "study/NewPage/new-page-phone",
    "pad": "study/NewPage/new-page-pad"
  },
  "resources": [
    {
      "id": 1,
      "name": "背景图",
      "type": "upload",
      "widthExact": 375,
      "heightExact": 200,
      "helpLink": "帮助链接"
    }
  ]
}
```

2. **创建对应的组件文件**：
   - `src/components/study/NewPage/new-page-phone.vue`
   - `src/components/study/NewPage/new-page-pad.vue`

3. **重启开发服务器**（路由会自动生成）

### 方法二：使用生成工具

```javascript
import { createNewPage, resourceTemplates } from '@/utils/pageGenerator'

// 创建新页面
createNewPage({
  id: 'newPage',
  title: '新页面',
  category: 'study',
  image: 'https://example.com/image.png',
  resources: [
    resourceTemplates.imageUpload(1, '背景图', 375, 200, 'https://help.link'),
    resourceTemplates.textInput(2, '标题', '请输入标题', 'updateTitle')
  ]
})
```

## 🎨 资源类型配置

### 图片上传
```json
{
  "id": 1,
  "name": "背景图",
  "type": "upload",
  "widthExact": 375,
  "heightExact": 200,
  "minWidth": 300,
  "maxWidth": 500,
  "helpLink": "帮助链接"
}
```

### 图片卡片上传
```json
{
  "id": 2,
  "name": "轮播图",
  "type": "upload-picture-card",
  "minSize": { "width": 480, "height": 270 },
  "helpLink": "帮助链接"
}
```

### 颜色选择器
```json
{
  "id": 3,
  "name": "主题色",
  "type": "color",
  "presetColors": ["#ff0000", "#00ff00", "#0000ff"],
  "eventName": "updateThemeColor"
}
```

### 下拉选择
```json
{
  "id": 4,
  "name": "配色方案",
  "type": "select",
  "options": [
    { "value": "blue", "label": "蓝色" },
    { "value": "red", "label": "红色" }
  ],
  "helpLink": "帮助链接",
  "eventName": "updateColorScheme"
}
```

### 文本输入
```json
{
  "id": 5,
  "name": "标题",
  "type": "input",
  "placeholder": "请输入标题",
  "eventName": "updateTitle"
}
```

## 🔧 组件开发指南

### 组件模板

```vue
<template>
  <div class="component-container">
    <!-- 你的组件内容 -->
    <h1>{{ title }}</h1>
    <img v-if="backgroundImage" :src="backgroundImage" alt="背景图" />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import emitter from '@/utils/emitter'

// 响应式数据
const title = ref('默认标题')
const backgroundImage = ref('')

/**
 * 组件挂载时的初始化
 */
onMounted(() => {
  // 监听资源更新事件
  emitter.on('updateImage1', handleBackgroundUpdate)
  emitter.on('updateTitle', handleTitleUpdate)
})

/**
 * 处理背景图更新
 * @param {string} imageUrl - 图片URL
 */
const handleBackgroundUpdate = (imageUrl) => {
  backgroundImage.value = imageUrl
}

/**
 * 处理标题更新
 * @param {string} newTitle - 新标题
 */
const handleTitleUpdate = (newTitle) => {
  title.value = newTitle
}
</script>

<style scoped>
.component-container {
  width: 100%;
  height: 100%;
  /* 你的样式 */
}
</style>
```

### 事件系统

系统使用事件总线来处理资源变化：

- **图片资源**: `updateImage{resourceId}` (如: `updateImage1`)
- **自定义事件**: 使用配置中的 `eventName` 字段

## 📁 项目结构

```
src/
├── config/
│   └── pages.json              # 页面配置文件
├── components/
│   ├── DynamicPage.vue         # 动态页面组件
│   ├── ResourceRenderer.vue    # 资源渲染组件
│   ├── square/                 # 广场页组件
│   ├── study/                  # 学习页组件
│   └── mine/                   # 我的页组件
├── utils/
│   └── pageGenerator.js        # 页面生成工具
├── pages/
│   └── menu.vue               # 菜单页（已更新为配置驱动）
└── router/
    └── router.ts              # 路由配置（已更新为动态生成）
```

## 🔄 迁移现有页面

### 1. 分析现有页面

查看现有页面的结构，识别：
- 页面路径和标题
- 使用的组件
- 资源配置（上传组件、选择器等）

### 2. 添加到配置文件

将页面信息添加到 `pages.json` 中

### 3. 测试验证

确保页面在新系统中正常工作

### 4. 清理旧代码

移除路由文件中的手动配置

## 🎯 最佳实践

### 1. 命名规范

- **页面ID**: 使用驼峰命名，如 `homeActivityCard`
- **组件路径**: 使用分类/页面/类型的结构，如 `study/HomeActivityCard/box-phone`
- **资源ID**: 使用数字，从1开始递增

### 2. 组件组织

```
components/
├── 分类名/
│   ├── 页面名/
│   │   ├── 页面名-phone.vue
│   │   ├── 页面名-pad.vue
│   │   └── 子组件/
```

### 3. 资源配置

- 为每个资源提供清晰的名称和帮助链接
- 使用合适的尺寸限制
- 为交互元素提供 `eventName`

### 4. 图片资源

- 优先使用CDN链接
- 本地图片使用 `@/assets/` 路径
- 在菜单配置中正确处理本地图片导入

## 🐛 常见问题

### Q: 新增页面后看不到？
A: 确保重启了开发服务器，路由是在启动时生成的。

### Q: 组件加载失败？
A: 检查组件路径是否正确，确保文件存在。

### Q: 资源事件不响应？
A: 确保在组件中正确监听了事件，事件名称要与配置中的一致。

### Q: 本地图片不显示？
A: 检查菜单页面中的图片路径映射是否正确。

## 🔮 未来扩展

### 1. 页面模板

可以创建页面模板，快速生成相似页面：

```json
{
  "templates": {
    "studyPage": {
      "components": {
        "phone": "study/template/phone",
        "pad": "study/template/pad"
      },
      "defaultResources": [...]
    }
  }
}
```

### 2. 条件渲染

支持根据条件显示不同的资源：

```json
{
  "resources": [
    {
      "name": "主题色",
      "type": "color",
      "condition": {
        "field": "theme",
        "value": "custom"
      }
    }
  ]
}
```

### 3. 批量操作

支持批量创建、更新和删除页面的工具。

---

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查看控制台错误信息
2. 检查配置文件格式是否正确
3. 确认组件文件路径是否存在
4. 参考现有页面的配置示例

配置驱动的页面生成系统让页面管理变得更加简单和规范，享受高效的开发体验！ 🎉