<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>通用弹窗 - 可视化编辑器</title>
    <!-- 引入Tailwind CSS和DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <!-- 引入图标库 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- SVGA播放器库 -->
    <!-- 加载SVGA库包装器 -->
    <script src="libs/svgaplayer-wrapper.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        overflow: hidden;
      }

      /* 设备外壳模拟 */
      .device-mockup {
        position: relative;
        background: #fff;
        border: 12px solid #1f2937;
        border-radius: 40px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        overflow: hidden;
        flex-shrink: 0; /* 防止在Flex容器中被压缩 */
      }

      .device-mockup.phone {
        width: 375px;
        height: 812px;
      }

      .device-mockup.pad {
        width: 1024px;
        height: 768px;
        border-width: 16px;
        border-radius: 24px;
      }

      /* 屏幕容器 */
      .screen-container {
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: relative;
        background-color: #fff;
      }

      .phone-bg {
        background-image: url(https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png);
        background-size: cover;
        background-position: center;
      }

      .pad-bg {
        background-image: url("https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png");
        background-size: cover;
        background-position: center;
      }

      /* --- 组件 CSS --- */
      .element {
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        width: 100%;
        height: 100%;
        align-items: flex-end;
      }

      .element-pad {
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
      }

      .main {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .closed {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
        width: 20.9375em;
        padding: 0.5em 0;
      }

      .element-pad .closed {
        width: 26.171875em;
      }

      .pop {
        width: 20.9375em;
        max-height: 27.8125em;
        min-height: 20.9375em;
      }

      .element-pad .pop {
        width: 26.171875em;
        max-height: 34.765625em;
        min-height: 26.171875em;
      }

      .pop img {
        width: 100%;
        height: auto;
      }

      .pop .game-guide {
        width: 20.9375em;
        height: 27.8125em;
      }

      .element-pad .pop .game-guide {
        width: 26.171875em;
        height: 34.765625em;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      @keyframes progress {
        0% {
          width: 0%;
        }
        100% {
          width: 100%;
        }
      }

      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* UI Helper Classes */
      .preview-wrapper {
        background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
        background-size: 20px 20px;
        overflow: hidden; /* 禁止滚动，完全依赖缩放 */
      }

      /* Stage Transition */
      #presentation-stage {
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        transform-origin: center center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 40px;
      }

      /* Sidebar Transition */
      #config-sidebar {
        transition: width 0.3s ease, transform 0.3s ease;
      }

      .toggle-btn {
        position: absolute;
        left: -24px;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 48px;
        background: white;
        border: 1px solid #e5e7eb;
        border-right: none;
        border-radius: 8px 0 0 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: -2px 0 8px rgba(0, 0, 0, 0.05);
        z-index: 50;
      }

      .sidebar-collapsed {
        width: 0 !important;
        border: none;
      }

      .sidebar-collapsed .sidebar-content {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body class="bg-base-200 h-screen flex w-full">
    <!-- 1. 左侧预览区域 (Flex-1) -->
    <main
      class="flex-1 h-full flex flex-col bg-slate-100 relative overflow-hidden order-1"
    >
      <!-- 顶部工具栏 -->
      <div
        class="absolute top-6 left-1/2 -translate-x-1/2 z-50 bg-white/90 backdrop-blur p-1.5 rounded-full shadow-lg border border-white/50 flex gap-1"
      >
        <button
          class="btn btn-sm btn-ghost rounded-full px-5 data-[active=true]:bg-gray-900 data-[active=true]:text-white transition-all"
          id="btn-view-compare"
          onclick="switchView('compare')"
          data-active="true"
        >
          <i class="fa-solid fa-table-columns"></i> 对比
        </button>
        <button
          class="btn btn-sm btn-ghost rounded-full px-5 data-[active=true]:bg-gray-900 data-[active=true]:text-white transition-all"
          id="btn-view-phone"
          onclick="switchView('phone')"
          data-active="false"
        >
          <i class="fa-solid fa-mobile-screen"></i> 手机
        </button>
        <button
          class="btn btn-sm btn-ghost rounded-full px-5 data-[active=true]:bg-gray-900 data-[active=true]:text-white transition-all"
          id="btn-view-pad"
          onclick="switchView('pad')"
          data-active="false"
        >
          <i class="fa-solid fa-tablet-screen-button"></i> 平板
        </button>
      </div>

      <!-- 预览画布容器 -->
      <div
        class="w-full h-full flex items-center justify-center preview-wrapper relative"
        id="preview-container"
      >
        <!-- 舞台：包含所有设备，通过 JS 控制显隐和缩放 -->
        <div id="presentation-stage">
          <!-- 手机模型 -->
          <div id="phone-mockup-wrapper" class="device-mockup phone">
            <div class="screen-container phone-bg">
              <div class="element">
                <div class="main">
                  <div class="closed">
                    <svg
                      width="42"
                      height="42"
                      viewBox="0 0 42 42"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <rect
                        width="42"
                        height="42"
                        fill="black"
                        fill-opacity="0.01"
                      />
                      <circle
                        cx="21"
                        cy="21.0002"
                        r="18.0955"
                        stroke="white"
                        stroke-width="1.26847"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M26.6199 17.5782C27.126 16.9651 27.0923 16.0559 26.5186 15.4822C25.9091 14.8727 24.9208 14.8727 24.3113 15.4822L21.0002 18.7933L17.6892 15.4822L17.5778 15.381C16.9647 14.8748 16.0555 14.9086 15.4819 15.4822C14.8723 16.0918 14.8723 17.08 15.4819 17.6896L18.7929 21.0006L15.482 24.3115L15.3808 24.4229C14.8746 25.036 14.9083 25.9452 15.482 26.5188C16.0916 27.1284 17.0798 27.1284 17.6893 26.5188L21.0002 23.2079L24.3111 26.5188L24.4225 26.6201C25.0356 27.1263 25.9448 27.0925 26.5185 26.5188C27.128 25.9093 27.128 24.9211 26.5185 24.3115L23.2076 21.0006L26.5186 17.6896L26.6199 17.5782Z"
                        fill="white"
                      />
                    </svg>
                  </div>
                  <div class="pop">
                    <!-- 使用一个容器来切换显示/隐藏 -->
                    <img
                      class="image"
                      id="phone-image"
                      src="https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png"
                    />
                    <div
                      id="phone-svga-container"
                      class="game-guide"
                      style="display: none"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 平板模型 -->
          <div id="pad-mockup-wrapper" class="device-mockup pad">
            <div class="screen-container pad-bg">
              <div class="element-pad">
                <div class="main">
                  <div class="closed">
                    <svg
                      width="42"
                      height="42"
                      viewBox="0 0 42 42"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <rect
                        width="42"
                        height="42"
                        fill="black"
                        fill-opacity="0.01"
                      />
                      <circle
                        cx="21"
                        cy="21.0002"
                        r="18.0955"
                        stroke="white"
                        stroke-width="1.26847"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M26.6199 17.5782C27.126 16.9651 27.0923 16.0559 26.5186 15.4822C25.9091 14.8727 24.9208 14.8727 24.3113 15.4822L21.0002 18.7933L17.6892 15.4822L17.5778 15.381C16.9647 14.8748 16.0555 14.9086 15.4819 15.4822C14.8723 16.0918 14.8723 17.08 15.4819 17.6896L18.7929 21.0006L15.482 24.3115L15.3808 24.4229C14.8746 25.036 14.9083 25.9452 15.482 26.5188C16.0916 27.1284 17.0798 27.1284 17.6893 26.5188L21.0002 23.2079L24.3111 26.5188L24.4225 26.6201C25.0356 27.1263 25.9448 27.0925 26.5185 26.5188C27.128 25.9093 27.128 24.9211 26.5185 24.3115L23.2076 21.0006L26.5186 17.6896L26.6199 17.5782Z"
                        fill="white"
                      />
                    </svg>
                  </div>
                  <div class="pop">
                    <!-- 使用一个容器来切换显示/隐藏 -->
                    <img
                      class="image"
                      id="pad-image"
                      src="https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png"
                    />
                    <div
                      id="pad-svga-container"
                      class="game-guide"
                      style="display: none"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 缩放提示 -->
      <div
        class="absolute bottom-4 right-4 text-xs text-gray-400 bg-white/80 px-2 py-1 rounded backdrop-blur"
      >
        Zoom: <span id="scale-val">100%</span>
      </div>
    </main>

    <!-- 2. 右侧配置面板 (Order-2) -->
    <aside
      id="config-sidebar"
      class="w-[380px] bg-base-100 h-full flex flex-col border-l border-base-300 shadow-xl z-20 relative order-2"
    >
      <!-- 收起/展开按钮 -->
      <div
        class="toggle-btn text-gray-500 hover:text-primary"
        onclick="toggleSidebar()"
      >
        <i class="fa-solid fa-chevron-right" id="toggle-icon"></i>
      </div>

      <!-- 侧边栏内容容器 -->
      <div
        class="sidebar-content flex flex-col h-full w-[380px] transition-opacity duration-200"
      >
        <div class="p-5 border-b border-base-200 bg-white shrink-0">
          <div class="flex items-center gap-2">
            <h1 class="text-lg font-bold text-gray-800">通用弹窗配置</h1>
          </div>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-8">
          <!-- 图片上传组 -->
          <div class="space-y-3">
            <h3
              class="text-sm font-bold uppercase text-gray-400 tracking-wider flex items-center gap-2"
            >
              <i class="fa-regular fa-image"></i> 弹窗配图
            </h3>
            <div
              class="bg-base-200 rounded-xl p-4 border border-base-300 border-dashed hover:border-primary transition-colors relative group"
            >
              <input
                type="file"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                accept="image/*"
                id="resource-image"
              />
              <div class="text-center" id="upload-placeholder">
                <div
                  class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-2 shadow-sm group-hover:scale-110 transition-transform text-primary"
                >
                  <i class="fa-solid fa-cloud-arrow-up text-xl"></i>
                </div>
                <p class="text-sm font-medium text-gray-600">点击上传资源图</p>
                <p class="text-xs text-gray-400 mt-1">推荐尺寸: 750x800</p>
              </div>
              <div class="hidden relative z-20" id="upload-preview-container">
                <img
                  id="preview-resource"
                  class="w-full h-32 object-contain rounded-lg bg-white"
                />
                <button
                  onclick="clearImage(event)"
                  class="absolute -top-2 -right-2 btn btn-circle btn-xs btn-error text-white shadow-md"
                >
                  <i class="fa-solid fa-times"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- SVGA动画上传组 -->
          <div class="space-y-3">
            <h3
              class="text-sm font-bold uppercase text-gray-400 tracking-wider flex items-center gap-2"
            >
              <i class="fa-solid fa-film"></i> SVGA动画
            </h3>
            <div
              class="bg-base-200 rounded-xl p-4 border border-base-300 border-dashed hover:border-primary transition-colors relative group"
            >
              <input
                type="file"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                accept=".svga"
                id="resource-svga"
              />
              <div class="text-center" id="svga-upload-placeholder">
                <div
                  class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-2 shadow-sm group-hover:scale-110 transition-transform text-primary"
                >
                  <i class="fa-solid fa-cloud-arrow-up text-xl"></i>
                </div>
                <p class="text-sm font-medium text-gray-600">
                  点击上传SVGA文件
                </p>
                <p class="text-xs text-gray-400 mt-1">支持SVGA格式动画</p>
              </div>
              <div
                class="hidden relative z-20"
                id="svga-upload-preview-container"
              >
                <div
                  class="w-full h-32 flex items-center justify-center rounded-lg bg-white"
                >
                  <span class="text-sm text-gray-500">SVGA文件已上传</span>
                </div>
                <button
                  onclick="clearSvga(event)"
                  class="absolute -top-2 -right-2 btn btn-circle btn-xs btn-error text-white shadow-md"
                >
                  <i class="fa-solid fa-times"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- 内容类型选择 -->
          <div class="space-y-4">
            <h3
              class="text-sm font-bold uppercase text-gray-400 tracking-wider flex items-center gap-2"
            >
              <i class="fa-solid fa-toggle-on"></i> 内容类型
            </h3>
            <div class="flex space-x-4">
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text">显示图片</span>
                  <input
                    type="radio"
                    name="content-type"
                    class="radio radio-primary"
                    id="show-image"
                    checked
                  />
                </label>
              </div>
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text">显示动画</span>
                  <input
                    type="radio"
                    name="content-type"
                    class="radio radio-primary"
                    id="show-svga"
                  />
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <script>
      // 全局SVGA播放器变量
      let phoneSvgaPlayer = null;
      let padSvgaPlayer = null;

      // --- 1. 侧边栏收起/展开逻辑 ---
      let isSidebarOpen = true;
      function toggleSidebar() {
        const sidebar = document.getElementById("config-sidebar");
        const icon = document.getElementById("toggle-icon");

        isSidebarOpen = !isSidebarOpen;

        if (!isSidebarOpen) {
          sidebar.classList.add("sidebar-collapsed");
          icon.classList.remove("fa-chevron-right");
          icon.classList.add("fa-chevron-left");
        } else {
          sidebar.classList.remove("sidebar-collapsed");
          icon.classList.remove("fa-chevron-left");
          icon.classList.add("fa-chevron-right");
        }

        // 侧边栏动画结束后重新计算缩放
        setTimeout(autoFit, 350);
      }

      // --- 2. 视图切换逻辑 ---
      let currentMode = "compare"; // 默认模式

      function switchView(type) {
        currentMode = type;

        // 更新按钮状态
        document.getElementById("btn-view-compare").dataset.active =
          type === "compare";
        document.getElementById("btn-view-phone").dataset.active =
          type === "phone";
        document.getElementById("btn-view-pad").dataset.active = type === "pad";

        const phoneWrapper = document.getElementById("phone-mockup-wrapper");
        const padWrapper = document.getElementById("pad-mockup-wrapper");

        // 根据模式显示/隐藏设备
        if (type === "compare") {
          phoneWrapper.style.display = "block";
          padWrapper.style.display = "block";
        } else if (type === "phone") {
          phoneWrapper.style.display = "block";
          padWrapper.style.display = "none";
        } else if (type === "pad") {
          phoneWrapper.style.display = "none";
          padWrapper.style.display = "block";
        }

        // 触发自动缩放
        autoFit();
      }

      // --- 3. 自动缩放逻辑 (核心优化) ---
      function autoFit() {
        const container = document.getElementById("preview-container");
        const stage = document.getElementById("presentation-stage");

        // 重置缩放以获取真实尺寸
        stage.style.transform = "scale(1)";

        // 获取容器尺寸 (减去padding)
        const containerW = container.clientWidth - 60;
        const containerH = container.clientHeight - 60;

        // 计算内容尺寸
        let contentW = 0;
        let contentH = 0;

        // 硬件尺寸常量
        const PHONE_W = 399; // 375 + border 24
        const PHONE_H = 836; // 812 + border 24
        const PAD_W = 1056; // 1024 + border 32
        const PAD_H = 800; // 768 + border 32
        const GAP = 40;

        if (currentMode === "compare") {
          contentW = PHONE_W + GAP + PAD_W;
          contentH = Math.max(PHONE_H, PAD_H);
        } else if (currentMode === "phone") {
          contentW = PHONE_W;
          contentH = PHONE_H;
        } else {
          contentW = PAD_W;
          contentH = PAD_H;
        }

        // 计算缩放比例
        const scaleX = containerW / contentW;
        const scaleY = containerH / contentH;
        let scale = Math.min(scaleX, scaleY);

        // 限制最大缩放为1，最小缩放为0.1
        scale = Math.min(Math.max(scale, 0.1), 1);

        // 应用缩放
        stage.style.transform = `scale(${scale})`;
        document.getElementById("scale-val").innerText =
          Math.round(scale * 100) + "%";
      }

      // 监听窗口大小变化和侧边栏动画
      window.addEventListener("resize", autoFit);

      // --- 4. 图片上传预览逻辑 ---
      function setupImagePreview() {
        const input = document.getElementById("resource-image");
        const preview = document.getElementById("preview-resource");
        const placeholder = document.getElementById("upload-placeholder");
        const previewContainer = document.getElementById(
          "upload-preview-container"
        );
        const phoneImg = document.getElementById("phone-image");
        const padImg = document.getElementById("pad-image");

        input.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const result = e.target.result;
              preview.src = result;
              phoneImg.src = result;
              padImg.src = result;

              // 切换到显示图片
              document.getElementById("show-image").checked = true;
              phoneImg.style.display = "block";
              document.getElementById("phone-svga-container").style.display =
                "none";
              padImg.style.display = "block";
              document.getElementById("pad-svga-container").style.display =
                "none";

              placeholder.classList.add("hidden");
              previewContainer.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
          }
        });
      }

      function clearImage(e) {
        e.preventDefault();
        e.stopPropagation();
        const input = document.getElementById("resource-image");
        const placeholder = document.getElementById("upload-placeholder");
        const previewContainer = document.getElementById(
          "upload-preview-container"
        );
        const phoneImg = document.getElementById("phone-image");
        const padImg = document.getElementById("pad-image");
        const defaultSrc =
          "https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png";

        input.value = "";
        phoneImg.src = defaultSrc;
        padImg.src = defaultSrc;
        placeholder.classList.remove("hidden");
        previewContainer.classList.add("hidden");
      }

      // --- 5. SVGA上传预览逻辑 ---
      function setupSvgaPreview() {
        const input = document.getElementById("resource-svga");
        const placeholder = document.getElementById("svga-upload-placeholder");
        const previewContainer = document.getElementById(
          "svga-upload-preview-container"
        );
        const phoneImg = document.getElementById("phone-image");
        const padImg = document.getElementById("pad-image");
        const phoneSvga = document.getElementById("phone-svga-container");
        const padSvga = document.getElementById("pad-svga-container");

        input.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            // 检查SVGA库是否已加载
            if (typeof SVGA === "undefined") {
              alert("SVGA库未加载，请刷新页面重试");
              return;
            }

            const fileReader = new FileReader();
            fileReader.onload = function (event) {
              // 创建Blob URL
              const blob = new Blob([event.target.result], {
                type: "application/octet-stream",
              });
              const blobUrl = URL.createObjectURL(blob);

              // 切换到显示SVGA
              document.getElementById("show-svga").checked = true;
              phoneImg.style.display = "none";
              phoneSvga.style.display = "block";
              padImg.style.display = "none";
              padSvga.style.display = "block";

              // 使用SVGA播放器播放文件
              try {
                // 初始化手机端SVGA播放器
                if (typeof phoneSvgaPlayer !== "undefined" && phoneSvgaPlayer) {
                  phoneSvgaPlayer.clear();
                }
                phoneSvgaPlayer = new SVGA.Player("#phone-svga-container");

                // 初始化平板端SVGA播放器
                if (typeof padSvgaPlayer !== "undefined" && padSvgaPlayer) {
                  padSvgaPlayer.clear();
                }
                padSvgaPlayer = new SVGA.Player("#pad-svga-container");

                // 使用解析器解析并播放
                const parser = new SVGA.Parser();
                parser.load(blobUrl, function (videoItem) {
                  phoneSvgaPlayer.setVideoItem(videoItem);
                  phoneSvgaPlayer.startAnimation();

                  padSvgaPlayer.setVideoItem(videoItem);
                  padSvgaPlayer.startAnimation();
                });
              } catch (error) {
                console.error("SVGA播放错误:", error);
                // 如果播放失败，显示错误信息
                phoneSvga.innerHTML =
                  '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background-color: #ffebee; color: #c62828; border-radius: 8px; text-align: center; padding: 20px;">SVGA文件无法播放</div>';
                padSvga.innerHTML =
                  '<div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; background-color: #ffebee; color: #c62828; border-radius: 8px; text-align: center; padding: 20px;">SVGA文件无法播放</div>';
              }

              placeholder.classList.add("hidden");
              previewContainer.classList.remove("hidden");
            };
            fileReader.readAsArrayBuffer(file);
          }
        });
      }

      function clearSvga(e) {
        e.preventDefault();
        e.stopPropagation();
        const input = document.getElementById("resource-svga");
        const placeholder = document.getElementById("svga-upload-placeholder");
        const previewContainer = document.getElementById(
          "svga-upload-preview-container"
        );
        const phoneImg = document.getElementById("phone-image");
        const padImg = document.getElementById("pad-image");
        const phoneSvga = document.getElementById("phone-svga-container");
        const padSvga = document.getElementById("pad-svga-container");
        const defaultSrc =
          "https://uiweb.oss-cn-chengdu.aliyuncs.com/img/通用广告弹窗/默认弹窗.png";

        // 清理SVGA播放器
        if (typeof phoneSvgaPlayer !== "undefined" && phoneSvgaPlayer) {
          phoneSvgaPlayer.clear();
        }
        if (typeof padSvgaPlayer !== "undefined" && padSvgaPlayer) {
          padSvgaPlayer.clear();
        }

        input.value = "";
        phoneSvga.style.display = "none";
        padSvga.style.display = "none";
        phoneImg.style.display = "block";
        padImg.style.display = "block";
        phoneSvga.innerHTML = ""; // 清除容器内容
        padSvga.innerHTML = ""; // 清除容器内容
        placeholder.classList.remove("hidden");
        previewContainer.classList.add("hidden");
      }

      // --- 6. 内容类型切换逻辑 ---
      function setupContentTypeToggle() {
        const showImageRadio = document.getElementById("show-image");
        const showSvgaRadio = document.getElementById("show-svga");
        const phoneImg = document.getElementById("phone-image");
        const padImg = document.getElementById("pad-image");
        const phoneSvga = document.getElementById("phone-svga-container");
        const padSvga = document.getElementById("pad-svga-container");

        showImageRadio.addEventListener("change", function () {
          if (this.checked) {
            phoneImg.style.display = "block";
            phoneSvga.style.display = "none";
            padImg.style.display = "block";
            padSvga.style.display = "none";
          }
        });

        showSvgaRadio.addEventListener("change", function () {
          if (this.checked) {
            phoneImg.style.display = "none";
            phoneSvga.style.display = "block";
            padImg.style.display = "none";
            padSvga.style.display = "block";

            // 如果SVGA播放器已存在，重新开始动画
            if (typeof phoneSvgaPlayer !== "undefined" && phoneSvgaPlayer) {
              phoneSvgaPlayer.startAnimation();
            }
            if (typeof padSvgaPlayer !== "undefined" && padSvgaPlayer) {
              padSvgaPlayer.startAnimation();
            }
          }
        });
      }

      // --- 初始化 ---
      document.addEventListener("DOMContentLoaded", function () {
        setupImagePreview();
        setupSvgaPreview();
        setupContentTypeToggle();

        // 初始执行一次缩放
        autoFit();
      });
    </script>
  </body>
</html>
